SELECT distinct

-- PersonId to match with all View's // tblDivisionStudent
    tDS.serviceTblPerson AS TblPerson_Id,
-- tblLevel
    tL.Id AS TblLevel_Id,
    tL.Name AS TblLevel_Name,
    tL.Description AS TblLevel_Description,
    tL.IsChecked AS TblLevel_IsChecked,
-- tblDivision
    tD.Name AS TblDivision_Name,
    tD.Description AS TblDivision_Description,
    concat(tL.Name, tD.Name) as TblDivision_Display,
-- tblCompany
    tC.Name as TblCompany_Name,
    concat(tC.Name, ' ', tC.ExtendedName) as TblCompany_Name_ExtendedName,
-- tblType
    tT.Name AS TblType_Name,
    tT.Description AS TblType_Description,
-- tblYear
    (CASE WHEN (ISNULL(tY.Year) OR (tY.Year = '')) THEN tY.Name ELSE tY.Year END) AS TblYear_Year,
    tY.Description AS TblYear_Description

FROM {{ ConsumerAcronym }}_EducationLessonDivision.tblDivisionStudent tDS
	LEFT JOIN {{ ConsumerAcronym }}_EducationLessonDivision.tblDivision tD ON tD.Id = tDS.tblDivision
		AND tD.EntityRemove IS NULL
	LEFT JOIN {{ ConsumerAcronym }}_CorporationCompany.tblCompany tC ON tC.Id = tD.serviceTblCompany
		AND tC.EntityRemove IS NULL
	LEFT JOIN {{ ConsumerAcronym }}_EducationLessonDivision.tblLevel tL ON tL.Id = tD.tblLevel
		AND tL.EntityRemove IS NULL
	LEFT JOIN {{ ConsumerAcronym }}_EducationSchoolType.tblType tT ON tT.Id = tL.serviceTblType
	LEFT JOIN {{ ConsumerAcronym }}_EducationLessonTerm.tblYear tY ON tY.Id = tD.serviceTblYear
-- 	LEFT JOIN {{ ConsumerAcronym }}_EducationLessonTerm.tblYearPeriod tYP ON tYP.tblYear = tY.Id
-- 	LEFT JOIN {{ ConsumerAcronym }}_EducationLessonTerm.tblPeriod tP ON tP.Id = tYP.tblPeriod
WHERE tDS.EntityRemove IS NULL and
	(tDS.LeaveDate is null
	or (tDS.LeaveDate is not null and CURRENT_TIMESTAMP() <= tDS.LeaveDate))